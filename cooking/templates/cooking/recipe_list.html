{% extends "base.html" %}

{% load custom_filters_cooking %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">–†–µ—Ü–µ–ø—Ç–∏</h2>

    {% if user.is_authenticated %}
<a href="{% url 'create_recipe' %}" class="btn btn-success mb-3">–î–æ–±–∞–≤–∏ —Ä–µ—Ü–µ–ø—Ç–∞</a>
{% else %}
<a href="{% url 'login' %}" class="btn btn-primary mb-3">–í–ª–µ–∑ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏ –∑–∞ –ø–æ–≤–µ—á–µ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏</a>
{% endif %}
<div class="btn-group mb-4" role="group" aria-label="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏">
    <button type="button" class="btn btn-outline-secondary" data-category="all">–í—Å–∏—á–∫–∏</button>
    {% for category in categories %}
        <button type="button" class="btn btn-outline-secondary" data-category="{{ category.name }}">{{ category.name }}</button>
    {% endfor %}
</div>
<div class="row">
    {% for recipe in page_obj %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
            {% if recipe.image %}
                <img src="{{ recipe.image.url }}" class="card-img-top" alt="{{ recipe.name }}">
            {% else %}
                <img src="/media/recipe_images/no_image.png" class="card-img-top" alt="Default Image">
            {% endif %}
            <div class="card-body">
                <h5 class="card-title"><a href="{% url 'recipe_view' recipe.id %}">{{ recipe.name }}</a></h5>
                <p class="card-text"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ recipe.category.name }}</p>
                <p class="card-text"><strong>–í—Ä–µ–º–µ –∑–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ:</strong> {{ recipe.time_to_prepare }} –º–∏–Ω</p>
                <p class="card-text"><strong>–¶–µ–Ω–∞:</strong> {% if user.is_authenticated %}{{ recipe.user_cost }} –ª–≤.{% else %}N/A{% endif %}</p>
                <p class="card-text"><strong>–ö–∞–ª–æ—Ä–∏–∏:</strong> {{ recipe.calculate_calories }} kcal</p>
                {% if recipe.user_availability_status == "OK" %}
                    <p class="text-success">‚úÖ –í—Å–∏—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –Ω–∞–ª–∏—á–Ω–∏</p>
                {% else %}
                    <p class="text-danger">‚ùå –õ–∏–ø—Å–≤–∞—â–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</p>
                {% endif %}

                {% if not recipe.user_availability %}
                <form action="{% url 'generate_recipe_shopping_list' recipe.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-warning btn-sm mt-2">üõí –ì–µ–Ω–µ—Ä–∏—Ä–∞–π —Å–ø–∏—Å—ä–∫</button>
                </form>
                {% endif %}
                <form action="{% url 'cook_recipe' recipe.id %}" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm mt-2">üë®‚Äçüç≥ –ü—Ä–∏–≥–æ—Ç–≤–∏</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<nav aria-label="Recipe pagination">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}&category={{ selected_category }}">‚ùÆ –ü—Ä–µ–¥–∏—à–Ω–∞</a>
        </li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –æ—Ç {{ page_obj.paginator.num_pages }}</span></li>
        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}&category={{ selected_category }}">–°–ª–µ–¥–≤–∞—â–∞ ‚ùØ</a>
        </li>
        {% endif %}
    </ul>
</nav>
</div>

    <script>
        document.querySelectorAll(".btn-group button").forEach(button => {
    button.addEventListener("click", function () {
        const category = this.dataset.category;
        window.location.href = `?category=${category}&page=1`;
    });
});
    </script>


{% endblock %}

{#{% block content %}#}
{#    <h2>–†–µ—Ü–µ–ø—Ç–∏</h2>#}
{#    {% if user.is_authenticated %}#}
{#    <a href="{% url 'create_recipe' %}" class="shopping-button">–î–æ–±–∞–≤–∏ —Ä–µ—Ü–µ–ø—Ç–∞</a>#}
{#    {% else %}#}
{#    <a href="{% url 'login' %}" class="shopping-button">–í–ª–µ–∑ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏ –∑–∞ –ø–æ–≤–µ—á–µ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏</a>#}
{#    {% endif %}#}
{#    <p></p>#}
{##}
{#    <div class="category-buttons">#}
{#        <button data-category="all">–í—Å–∏—á–∫–∏</button>#}
{#        {% for category in categories %}#}
{#            <button data-category="{{ category.name }}">{{ category.name }}</button>#}
{#        {% endfor %}#}
{#    </div>#}
{##}
{#    <p></p>#}
{##}
{#    <div class="recipe-list">#}
{#        {% for recipe in page_obj %}#}
{#            <div class="recipe-card">#}
{#                {% if recipe.image %}#}
{#                    <img src="{{ recipe.image.url }}" alt="{{ recipe.name }}">#}
{#                {% else %}#}
{#                    <img src="/media/recipe_images/no_image.png" alt="Default Image">#}
{#                {% endif %}#}
{##}
{#                <div class="recipe-info">#}
{#                    <h3><a href="{% url 'recipe_view' recipe.id %}">{{ recipe.name }}</a></h3>#}
{#                    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ recipe.category.name }}</p>#}
{#                    <p><strong>–í—Ä–µ–º–µ –∑–∞ –ø—Ä–∏–≥–æ—Ç–≤—è–Ω–µ:</strong> {{ recipe.time_to_prepare }} –º–∏–Ω</p>#}
{#                    <p><strong>–¶–µ–Ω–∞:</strong>#}
{#                        {% if user.is_authenticated %}#}
{#                        {{ recipe.user_cost }} –ª–≤.#}
{#                    {% else %}#}
{#                        N/A#}
{#                        {% endif %}#}
{#                    </p>#}
{#                    <p><strong>–ö–∞–ª–æ—Ä–∏–∏:</strong> {{ recipe.calculate_calories }} kcal</p>#}
{##}
{#                    {% if recipe.user_availability_status == "OK" %}#}
{#                        <p style="color: green;">‚úÖ –í—Å–∏—á–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –Ω–∞–ª–∏—á–Ω–∏</p>#}
{#                    {% else %}#}
{#                        <p style="color: red;">‚ùå –õ–∏–ø—Å–≤–∞—â–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</p>#}
{#                    {% endif %}#}
{##}
{##}
{#                    {% if not recipe.user_availability %}#}
{#                        <form action="{% url 'generate_recipe_shopping_list' recipe.id %}" method="POST">#}
{#                            {% csrf_token %}#}
{#                            <button type="submit" class="generate-list-btn">–ì–µ–Ω–µ—Ä–∏—Ä–∞–π —Å–ø–∏—Å—ä–∫ –∑–∞ –ø–∞–∑–∞—Ä—É–≤–∞–Ω–µ</button>#}
{#                        </form>#}
{#                    {% endif %}#}
{##}
{#                    <form action="{% url 'cook_recipe' recipe.id %}" method="POST">#}
{#                        {% csrf_token %}#}
{#                        <button type="submit">–ü—Ä–∏–≥–æ—Ç–≤–∏</button>#}
{#                    </form>#}
{#                </div>#}
{#            </div>#}
{#        {% endfor %}#}
{#    </div>#}
{##}
{#    <div class="pagination">#}
{#        {% if page_obj.has_previous %}#}
{#            <a href="?page={{ page_obj.previous_page_number }}&category={{ selected_category }}">‚ùÆ –ü—Ä–µ–¥–∏—à–Ω–∞</a>#}
{#        {% endif %}#}
{#        <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –æ—Ç {{ page_obj.paginator.num_pages }}</span>#}
{#        {% if page_obj.has_next %}#}
{#            <a href="?page={{ page_obj.next_page_number }}&category={{ selected_category }}">–°–ª–µ–¥–≤–∞—â–∞ ‚ùØ</a>#}
{#        {% endif %}#}
{#    </div>#}
    <script>
        document.querySelectorAll(".category-buttons button").forEach(button => {
            button.addEventListener("click", function () {
                const category = this.dataset.category;
                window.location.href = `?category=${category}&page=1`;
            });
        });
    </script>
{#{% endblock %}#}