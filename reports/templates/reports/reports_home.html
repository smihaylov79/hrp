{% extends 'base.html' %}

{% block content %}

<a>Общо разходи: {{ total_spent }}</a>

    <form method="GET" action="{% url 'reports_home' %}">
        <div class="filter-container">
            <div class="filter-item">
                <label for="main_category">Категория:</label>
                <select name="main_category">
                    <option value="">Всички категории</option>
                    {% for category in main_categories %}
                        <option value="{{ category.id }}"
                                {% if request.GET.main_category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>

                <label for="date_from">От:
                    <input type="date" name="date_from" value="{{ date_from_filter }}"></label>
                    <label for="date_to">До:
                    <input type="date" name="date_to" value="{{ date_to_filter }}"></label>
            </div>
        <button type="submit">Приложи филтри</button>

        </div>

    </form>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <div id="monthly_spent" style="width:100%; height:400px;"></div>
    <div id="weekly_spent" style="width:100%; height:400px;"></div>

    <script>
        const data = JSON.parse('{{ monthly_data|escapejs }}');

        Highcharts.chart('monthly_spent', {
            chart: {
                type: 'line'
            },
            title: {
                text: 'Разходи по месец'
            },
            xAxis: {
                categories: data.map(item => item.month),
                title: { text: 'Месец' }
            },
            yAxis: {
                min: 0,
                title: { text: 'лв.' }
            },
            series: [{
                name: 'Общо',
                data: data.map(item => item.total)
            }]
        });
    </script>
    <script>
        const weeklyData = JSON.parse('{{ weekly_data|escapejs }}');

        Highcharts.chart('weekly_spent', {
            chart: {
                type: 'line'
            },
            title: {
                text: 'Разходи по седмица'
            },
            xAxis: {
                categories: weeklyData.map(item => item.week),
                title: { text: 'седмица' }
            },
            yAxis: {
                min: 0,
                title: { text: 'лв.' }
            },
            series: [{
                name: 'Общо',
                data: weeklyData.map(item => item.total)
            }]
        });
    </script>

{% endblock %}