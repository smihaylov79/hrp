{% extends 'reports/reports_home.html' %}

{% block report_body %}

<div class="container mt-4">
  <h2 class="text-center mb-4">üí∂ –ê–Ω–∞–ª–∏–∑ –Ω–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ</h2>

  <!-- –§–æ—Ä–º–∞ –∑–∞ —Ñ–∏–ª—Ç—Ä–∏ -->
  <form method="get" class="mb-4">
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">–§–∏–ª—Ç—Ä–∏—Ä–∞–π</button>
  </form>

  {% if total_income %}
    <div class="card mb-4 shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">–û–±—â–∞ —Å—É–º–∞ –ø—Ä–∏—Ö–æ–¥–∏</h5>
        <p class="fs-3 text-success">{{ total_income }} {{ selected_currency }}</p>
      </div>
    </div>

    <!-- –õ–∏–Ω–µ–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –ø–æ –º–µ—Å–µ—Ü–∏ -->
    <div id="income-monthly-chart" class="mb-4"></div>

    <!-- Pie chart –ø–æ —Ç–∏–ø–æ–≤–µ –ø—Ä–∏—Ö–æ–¥–∏ -->
    <div id="income-type-chart" class="mb-4"></div>

      <script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>


    <script>
      document.addEventListener("DOMContentLoaded", function () {
        Highcharts.chart("income-monthly-chart", {
          chart: { type: "line" },
          title: { text: "–ü—Ä–∏—Ö–æ–¥–∏ –ø–æ –º–µ—Å–µ—Ü–∏" },
          xAxis: { categories: {{ month_labels|safe }} },
          yAxis: { title: { text: "–°—É–º–∞ ({{ selected_currency }})" } },
          series: {{ monthly_series|safe }}
        });

        Highcharts.chart("income-type-chart", {
          chart: { type: "pie" },
          title: { text: "–ü—Ä–∏—Ö–æ–¥–∏ –ø–æ —Ç–∏–ø–æ–≤–µ" },
          series: [{
            name: "–°—É–º–∞ ({{ selected_currency }})",
            colorByPoint: true,
            data: {{ type_series|safe }}
          }]
        });
      });
    </script>
  {% else %}
    <div class="alert alert-info text-center">
      –ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –ø—Ä–∏—Ö–æ–¥–∏ –≤ –∏–∑–±—Ä–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥.
    </div>
  {% endif %}
</div>
{% endblock %}
