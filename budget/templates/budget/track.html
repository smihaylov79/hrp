{% extends "base.html" %}
{% block content %}
    <div class="container mt-4">

    <div class="d-flex justify-content-center gap-3 mt-4">
        <h2>–ò–∑–ø—ä–ª–Ω–µ–Ω–∏–µ –Ω–∞ –±—é–¥–∂–µ—Ç {{ budget.name }}: {{ budget.date_from }} - {{ budget.date_to }}</h2>
    <a href="{% url 'budget_home' %}" class="btn btn-secondary px-4">
    üìÅ –í—Å–∏—á–∫–∏ –±—é–¥–∂–µ—Ç–∏
  </a>
    </div>

        <h4>–û–±—â–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ:</h4>

<div class="container">

  <!-- –†–∞–∑—Ö–æ–¥–∏ -->
  <div class="row align-items-center mb-3">
    <div class="col-md-4">
      <table class="table table-borderless table-sm mb-0">
        <tr><th class="text-start">–ü–ª–∞–Ω–∏—Ä–∞–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏ –æ–±—â–æ:</th><td>{{ total_planned }} {{ budget.currency }}</td></tr>
        <tr><th class="text-start">–ü–ª–∞–Ω–∏—Ä–∞–Ω–∏ –¥–æ –¥–Ω–µ—Å:</th><td>{{ ytd_planned }} {{ budget.currency }}</td></tr>
        <tr><th class="text-start">–†–µ–∞–ª–Ω–æ:</th><td>{{ total_actual }} {{ budget.currency }}</td></tr>
      </table>
    </div>
    <div class="col-md-8">
      <div class="progress" style="height: 25px;">
        <div class="progress-bar {% if time_is_behind %}bg-danger{% else %}bg-success{% endif %}"
             role="progressbar"
             style="width: {{ total_percent }}%;">
          {{ total_percent }}%
        </div>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∏—Ö–æ–¥–∏ -->
  <div class="row align-items-center mb-3">
    <div class="col-md-4">
      <table class="table table-borderless table-sm mb-0">
        <tr><th class="text-start">–ü–ª–∞–Ω–∏—Ä–∞–Ω–∏ –ø—Ä–∏—Ö–æ–¥–∏ –æ–±—â–æ:</th><td>{{ planned_income }} {{ budget.currency }}</td></tr>
        <tr><th class="text-start">–ü–ª–∞–Ω–∏—Ä–∞–Ω–∏ –¥–æ –¥–Ω–µ—Å:</th><td>{{ ytd_planned_income }} {{ budget.currency }}</td></tr>
        <tr><th class="text-start">–†–µ–∞–ª–Ω–æ:</th><td>{{ actual_income }} {{ budget.currency }}</td></tr>
      </table>
    </div>
    <div class="col-md-8">
      <div class="progress" style="height: 25px;">
        <div class="progress-bar {% if income_issue %}bg-danger{% else %}bg-success{% endif %}"
             role="progressbar"
             style="width: {{ income_percent }}%;">
          {{ income_percent }}%
        </div>
      </div>
    </div>
  </div>

  <!-- –í—Ä–µ–º–µ -->
  <div class="row align-items-center mb-3">
    <div class="col-md-4">
      <table class="table table-borderless table-sm mb-0">
        <tr><th class="text-start">–ò–∑–º–∏–Ω–∞–ª–æ –≤—Ä–µ–º–µ:</th><td>{{ time_percent }}%</td></tr>
      </table>
    </div>
    <div class="col-md-8">
      <div class="progress" style="height: 25px;">
        <div class="progress-bar bg-info"
             role="progressbar"
             style="width: {{ time_percent }}%;">
          {{ time_percent }}%
        </div>
      </div>
    </div>
  </div>

</div>


        <table class="table table-striped align-middle">
            <thead>
            <tr>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–ü–ª–∞–Ω–∏—Ä–∞–Ω–æ</th>
                <th>–ü–ª–∞–Ω–∏—Ä–∞–Ω–æ YTD</th>
                <th>–†–µ–∞–ª–Ω–æ</th>
                <th>% –¥–æ –¥–Ω–µ—Å</th>
                <th>% —Ü—è–ª–∞ –≥–æ–¥–∏–Ω–∞</th>
            </tr>
            </thead>
            <tbody>
            {% for row in tracking %}
                <tr>
                    <td>{{ row.category }}</td>
                    <td>{{ row.planned }}</td>
                    <td>{{ row.ytd }}</td>
                    <td>{{ row.actual }}</td>
                    <td style="width: 250px;">
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar
                          {% if row.percent < 80 %}bg-success{% elif row.percent < 100 %}bg-warning{% else %}bg-danger{% endif %}"
                                 role="progressbar"
                                 style="width: {{ row.percent }}%;"
                                 aria-valuenow="{{ row.percent }}"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                {{ row.percent_ytd }}%
                            </div>
                        </div>
                    </td>
                    <td style="width: 250px;">
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar
                          {% if row.percent < 80 %}bg-success{% elif row.percent < 100 %}bg-warning{% else %}bg-danger{% endif %}"
                                 role="progressbar"
                                 style="width: {{ row.percent }}%;"
                                 aria-valuenow="{{ row.percent }}"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                {{ row.percent }}%
                            </div>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <!-- Highcharts -->
        <div id="budget-chart" style="height: 400px;"></div>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script>
            Highcharts.chart("budget-chart", {
                chart: {type: "column"},
                title: {text: "–ë—é–¥–∂–µ—Ç vs –†–µ–∞–ª–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏"},
                xAxis: {categories: {{ categories|safe }}},
                yAxis: {title: {text: "–°—É–º–∞ ({{ budget.currency }})"}},
                series: [
                    {name: "–ü–ª–∞–Ω–∏—Ä–∞–Ω–æ", data: {{ planned_series|safe }}},
                    {name: "–†–µ–∞–ª–Ω–æ", data: {{ actual_series|safe }}}
                ]
            });
        </script>
    </div>
{% endblock %}
