{% extends "finance/navigation.html" %}

{% block finance_navigation %}

<div class="container my-4">

<div class="row row-cols-2 row-cols-md-5 g-2 mb-2">
  {% for market in markets %}
  <div class="col">
    <div class="card border {% if market.current_status == 'open' %}border-success{% else %}border-danger{% endif %}">
      <div class="card-body py-2 px-2">

        <h6 class="card-title mb-1 fw-semibold small">
          {{ market.name }}
        </h6>

        <p class="mb-0 small">
          üïí <span class="time-local" data-utc="{{ market.utc_open }}"></span> ‚Äì
          <span class="time-local" data-utc="{{ market.utc_close }}"></span>
        </p>

        <p class="text-muted small mb-0">
          {{ market.countdown_text }}
        </p>

      </div>
    </div>
  </div>
  {% endfor %}
</div>


    <div class="container my-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="mb-3">üì∞ Real‚ÄëTime News (FinancialJuice)</h5>

      <iframe
        src="https://www.financialjuice.com/iframe.aspx"
        style="width:100%; height:500px; border:none;">
      </iframe>

      <p class="text-muted small mt-2">
        Source: FinancialJuice (free real‚Äëtime squawk + headlines)
      </p>
    </div>
  </div>
</div>


  <div class="container my-4">
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
            <div class="col">
                <a href="{% url 'trade' %}" class="text-decoration-none">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">üí± –¢—ä—Ä–≥–æ–≤–∏—è</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'invest' %}" class="text-decoration-none">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">üå± –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'news' %}" class="text-decoration-none">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">üì∞ –ù–æ–≤–∏–Ω–∏</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'markets' %}" class="text-decoration-none">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">üíπ –ü–∞–∑–∞—Ä–∏</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'portfolio' %}" class="text-decoration-none">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">üíº –ü–æ—Ä—Ç—Ñ–µ–π–ª</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="col">
                <a href="{% url 'screener' %}" class="text-decoration-none">
                    <div class="card text-center shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title">üîç –†–∞–¥–∞—Ä</h5>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

<!-- Countdown Script -->
<script>
function convertToLocal(utcString) {
  const dt = new Date(utcString);
  return dt.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function updateCountdowns() {
  const now = new Date();
  document.querySelectorAll(".countdown").forEach(el => {
    const open = new Date(el.dataset.open);
    const close = new Date(el.dataset.close);
    let diff, label;

    if (now < open) {
      diff = open - now;
      label = "Opens in";
    } else if (now >= open && now < close) {
      diff = close - now;
      label = "Closes in";
    } else {
      el.textContent = "Market is closed";
      return;
    }

    const h = Math.floor(diff / (1000 * 60 * 60));
    const m = Math.floor((diff / (1000 * 60)) % 60);
    el.textContent = `${label} ${h}h ${m}m`;
  });
}

function displayLocalTimes() {
  document.querySelectorAll(".time-local").forEach(el => {
    const utc = el.dataset.utc;
    el.textContent = convertToLocal(utc);
  });
}

document.addEventListener("DOMContentLoaded", () => {
  displayLocalTimes();
  updateCountdowns();
  setInterval(updateCountdowns, 60000);
});
</script>
{% endblock %}
